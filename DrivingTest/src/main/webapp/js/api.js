define("auth-sdk!app/api",[],function(){"use strict";var e=this.Simple,t=e.Core.Store,n=e.Core.Utils,r=(e.Core.Ajax,e.Core.Cookie),o=e.Core.Message,a=+new Date,i={path:"/",domain:location.hostname.replace(/^[^\.]*\./,".")},s=function(e){return e.domain&&(i.domain=e.domain),e.QQConfig&&I.QQ.set(e.QQConfig.appId,e.QQConfig.targetUrl,e.QQConfig.isMobile),$.Deferred().resolve()},u=function(e,t,n){e(!1,t,n[0])},c=function(){b();try{window.localStorage.setItem("mc_login",a)}catch(e){}o.trigger("auth-sdk.login")},d=function(e,n,r){return $.Deferred(function(o){var a=function(e,t,n){o.resolve(e,t,n)};t(["auth-sdk!user/"+e]).request([{params:n}],function(e){"update"===r&&c(),a(!0,e.data)},function(e,t){u(a,e,t)})})},g={login:function(e){var t=n.pick(e,"phoneNumber","password");return d("phoneLogin",t,"update")}},p={login:function(e){var t=n.pick(e,"thirdParty","openId","avatar","gender","nickname","description","homePage","birthday");return d("thirdLogin",t).then(function(e,n,r){return e&&n.authToken&&c(),e&&(n.openId=t.openId,n.thirdParty=t.thirdParty),$.Deferred().resolve(e,n,r)})}},f={getCaptcha:function(){return d("getSmsLoginCaptcha")},getMessage:function(e){var t=n.pick(e,"phoneNumber","captchaId","captchaCode");return d("getSmsLoginMessage",t)},login:function(e){var t=n.pick(e,"smsId","smsCode");return d("submitSmsLogin",t,"update")}},h={getCaptcha:function(){return d("getRegisterCaptcha")},getMessage:function(e){var t=n.pick(e,"phoneNumber","password","captchaId","captchaCode");return d("getRegisterMessage",t)},register:function(e){var t=n.pick(e,"smsId","smsCode");return d("register",t,"update")}},l={getMessage:function(e){var t=n.pick(e,"thirdParty","openId","phoneNumber","captchaId","captchaCode");return d("getBindMessage",t)},submit:function(e){var t=n.pick(e,"smsId","smsCode","thirdParty");return d("bindSubmit",t,"update")}},m={getCaptcha:function(){return d("getChangePhoneCaptcha")},getMessage:function(e){var t=n.pick(e,"phoneNumber","password","captchaId","captchaCode");return d("getChangePhoneMessage",t)},regetMessage:function(e){var t=n.pick(e,"smsId");return d("regetChangePhoneMessage",t)},submit:function(e){var t=n.pick(e,"smsId","smsCode");return d("submitChangePhoneSubmit",t,"update")}},v={set:{getCaptcha:function(){return d("getSetPasswordCaptcha")},getMessage:function(e){var t=n.pick(e,"phoneNumber","captchaId","captchaCode");return d("getSetPasswordMessage",t)},verifyMessage:function(e){var t=n.pick(e,"smsId","smsCode");return d("verifySetPasswordMessage",t)},submit:function(e){var t=n.pick(e,"smsId","smsToken","password");return d("submitSetPassword",t,"update")}},change:{submit:function(e){var t=n.pick(e,"oldPassword","newPassword");return d("changePassword",t,"update")}},forgot:{getCaptcha:function(){return d("getForgotPasswordCaptcha")},getMessage:function(e){var t=n.pick(e,"phoneNumber","captchaId","captchaCode");return d("getForgotPasswordMessage",t)},regetMessage:function(e){var t=n.pick(e,"smsId");return d("regetForgotPasswordMessage",t)},verifyMessage:function(e){var t=n.pick(e,"smsId","smsCode");return d("verifyForgotPasswordMessage",t)},submit:function(e){var t=n.pick(e,"smsId","smsToken","password");return d("submitForgotPassword",t,"update")}}},w={getCaptcha:function(){return d("getVerifyPhoneCaptcha")},getMessage:function(e){var t=n.pick(e,"phoneNumber","captchaId","captchaCode");return d("getVerifyPhoneMessage",t)},submit:function(e){var t=n.pick(e,"smsId","smsCode");return d("submitVerifyPhone",t,"update")}},C=function(e){var t=n.pick(e,"captchaId","captchaCode");return d("protectionVerify",t)},I={};!function(){var e={appId:"",targetUrl:"",isMobile:!1},t=function(t,n,r){return e.appId=t,e.isMobile=r,e.targetUrl=n,void 0===r&&(e.isMobile=!!navigator.userAgent.match(/mobile/i)),$.Deferred().resolve()},n=function(){var t=function(e,n){return window.QC&&window.QC.Login?(e.resolve(),!0):void(n&&setTimeout(function(){t(e,n)},50))};return $.Deferred(function(n){if(!t(n)){var r=document.createElement("script");r.setAttribute("type","text/javascript"),r.setAttribute("data-appid",e.appId),r.setAttribute("data-redirecturi",e.targetUrl),r.setAttribute("charset","utf-8"),r.src="http://qzonestyle.gtimg.cn/qzone/openapi/qc_loader.js","onload"in r?r.onload=n.resolve:r.attachEvent("onreadystatechange",function(){("loaded"==r.readyState||"complete"==r.readyState)&&n.resolve()}),document.head.appendChild(r)}}).then(function(){return $.Deferred(function(e){t(e,!0)})})},r=function(t){var r=e.isMobile?"mobile":"pc",o=!!t;return n().then(function(){return $.Deferred(o?function(e){window.QC.Login({btnId:"qq-login-s",size:"C_S",scope:"get_user_info",display:r||"mobile"},function(t,n){e.resolve(t,n)})}:function(e){window.QC.Login.check()&&window.QC.api("get_user_info",{}).success(function(t){var n=t.data||{};return e.resolve(n)})})}).then(function(e){return $.Deferred(function(t){window.QC.Login.getMe(function(n){return 0!=e.ret?t.resolve(!1,e.msg):(e.openId=n,t.resolve(!0,e))})})}).then(function(e,t){if(!e)return $.Deferred().resolve(e,t);var n=t.openId;return p.login({thirdParty:"qqspace",openId:n,avatar:t.figureurl_qq_2,gender:"\u7537"==t.gender?"Male":"Female",nickname:t.nickname}).then(function(e,r){return e&&(r.openId=n,r.thirdParty="qqspace"),$.Deferred().resolve(e,r,t)})})},o=function(){return n().then(function(){return window.QC.Login.signOut(),$.Deferred(function(e){setTimeout(function(){e.resolve()},200)})})};I.QQ={load:n,set:t,login:r,logout:o},I.Logout=function(e){return"qqspace"===e?o():$.Deferred().resolve()}}();var k={authToken:void 0,userInfo:void 0,getUserInfo:function(){return k.userInfo?$.Deferred().resolve(!0,k.userInfo):k.get()},get:function(){return d("getUserInfo",null,"update")},update:function(e){var t=n.pick(e,"nickname","gender","avatar","birthday","cityCode","description");return t=n.extend({},k.userInfo,t),d("updateUserInfo",t,"update")},profile:function(e){var t=n.pick(e,"mucangId");return d("getProfile",t)},logout:function(e){if(k.userInfo){var t,n,r=$.Deferred();return k.userInfo.thirdParty&&(t=I.QQ.logout(k.userInfo.thirdParty)),n=d("logout",{t:e?1:""}),$.when(t,n).then(function(){r.resolve(),c(),o.trigger("auth-sdk.logout",!0)}),r.promise()}}},b=function(){var e=r("MC_USER",i).get();try{e=JSON.parse(e)}catch(t){e=null}k.userInfo=e,e&&(k.authToken=e.authToken)};return b(),function(){var e=function(t){"mc_login"===t.key&&t.newValue&&t.newValue!=a&&(window.addEventListener?window.removeEventListener("storage",e,!1):window.detachEvent&&window.detachEvent("onstorage",e),window.location.reload())};if(!k.authToken&&window.localStorage)window.addEventListener?window.addEventListener("storage",e,!1):window.detachEvent&&window.attachEvent("onstorage",e);else try{window.localStorage.removeItem("mc_login")}catch(t){}}(),{phoneLogin:g,thirdLogin:p,messageLogin:f,register:h,bindUser:l,changePhone:m,password:v,verifyPhone:w,protectionVerify:C,User:k,Third:I,SetConfig:s}});