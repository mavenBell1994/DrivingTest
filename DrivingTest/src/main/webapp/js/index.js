define("jkbd!app/index",["jkbd-sdk!app/public","jkbd-sdk!data/constant","jkbd-sdk!core/Citycore"],function(t,e,a){"use strict";var n=this.Simple,r=(n.Core.Template,n.Core.Utils),i=n.Core.Message,o=n.Core.Store,c=function(){var t=function(t,e){var a=[],n=[],r=[];if("string"==typeof t){t=t.split(",");for(var i=0;i<t.length;i++){r=[];for(var n=t[i].trim().split(/\s/gi),o=0;o<n.length;o++)r.push("[data-"+e+'="'+n[o]+'"]');a.push(r.join(" "))}return $(a.join(","),this)}return $(a,this)};$.fn.item=function(e){return t.call(this,e,"item")}};c(),n.Template.helper("CarDaihaoMaps",{car:"c1",bus:"a1",truck:"b2",moto:"d",keyun:"ky",huoyun:"hy",jiaolian:"jl",weixian:"wx"}),n.Template.helper("GetImg",function(t){return t.match(/\.\w+$/)||(t+=".png"),t=t.replace(/(!)/,function(){return"/resources/images/"}),(__nodeConfig.CDN||"/web")+"/"+t}),n.Template.helper("SiteUrl",function(t){return t});var s=function(t,e,a){var n=p(e);if(window.__baiduTongjiUrl=n,a||_hmt.push(["_trackPageview",n]),a){var r=e.$page;_hmt.push(["ks","kslx","wz","zt","xinwen"].indexOf(r)>-1?["_trackEvent","www\u5173\u952e\u8bcd\u9875\u9762",n]:["_trackEvent","\u666e\u901a\u9875\u9762",n])}},h={kemu1:1,kemu2:1,kemu3:1,kemu4:1,zigezheng:1},p=function(t){var e=t.$page,n=t.$category,i=t.$path;["sign","photo"].indexOf(e)>-1?i="/"+e:0===t.$pathList.length?i="/home":1===t.$pathList.length?(a.pinyinMaps[e]||a.codeMaps[e])&&(i="/home"):2===t.$pathList.length&&(("news"===e||"xinwen"===e)&&(i="detail"===n?t.$path:"/"+e+"/category"),"mnks"===e&&n in h&&(i="/mnks/course"));var o={};return t.$search.from&&(o.from=t.$search.from,t.$search.at&&(o.at=t.$search.at)),o=r.convert.objectToParam(o),o&&(i+="?"+o),i},u=function(t,e,n){if(!n){var r=!1;setTimeout(function(){r||(r=!0,console.log("\u5b9a\u4f4d\u8d85\u65f6\u5566..."),e(!1))},3e3),o(["jkbd!common/location"]).request(function(t){r||(t.data&&t.data.code?e(t.data.code,a.getInfoByCode(t.data.code)):e(!1),r=!0)},function(){r||(e(!1),r=!0)})}},l=function(t){var e=t||location.pathname,a={$path:"",$htmls:[],$htmlsObject:{},$pathList:[]},n=e.replace(/^\/|\/$/g,"").split("/"),i=[];e.match(/\.html?$/)&&(i=n.pop().replace(/\.html?$/,"").split("-")),a.$path="/"+n.join("/"),a.$htmls=i,a.$pathList=n;for(var o=["$page","$category","$classify","$tab"],c=0;c<o.length;c++)a[o[c]]=n[c];var s=__nodeConfig.pathHtmls||{};for(var h in s){var p=new RegExp("^/("+h+")$");if(a.$path.match(p)){var u=s[h],l=d(i);a.$htmlsObject=l.$htmlParams;for(var c=0;c<u.length;c++)a.$htmlsObject[u[c]]=l.leftHtmls[c];break}}return a.$search=r.request.search.params(),a},d=function(t){for(var n={carType:void 0,daihao:void 0,course:void 0,cityPinyin:void 0},r=[],i=0;i<t.length;i++){var o=t[i];e.carNames[o]?n.carType=o:e.courseNames[o]?n.course=o:e.daihaoMaps[o]?n.daihao=o:a.pinyinMaps[o]?n.cityPinyin=o:0!=o&&a.codeMaps[o]?n.cityPinyin=a.codeMaps[o]:r.push(o)}return{$htmlParams:n,leftHtmls:r}},m=null,f=function(t,e){e=e||m||{};for(var a={_prev_:e,_changed_:!1,$path:!1,$htmls:{},$search:{}},n=["$path","$page","$category","$classify","$tab"],r=0;r<n.length;r++){var i=n[r];e[i]!=t[i]&&(a._changed_=!0,a[i]=!0)}var o=function(t,e){t=t||{},e=e||{};var a={_changed_:!1},n=[];for(var r in t)n.push(r);for(var r in e)n.push(r);for(var i=0;i<n.length;i++){var r=n[i];t[r]!=e[r]&&(a[r]=!0,a._changed_=!0)}return a};return a.$htmls=o(e.$htmlsObject,t.$htmlsObject),a.$search=o(e.$search,t.$search),(a.$htmls._changed_||a.$search._changed_)&&(a._changed_=!0),a},v=function(){var t=!m,e=l(),a=f(e,m||{});m=$.extend({},e),s(a,e,t),n.Create("jkbd!app/route/init",a,e,t)},g=function(){var t={},e=t.container=n.Container=$(document.body);t.top=e.item("jkbd-main-header-top"),t.navigate=e.item("jkbd-main-header-nav"),t.article=e.item("jkbd-main-main-container"),t.footer=e.item("jkbd-main-footer"),t.hook=e.item("jkbd-main-hook"),(window.browser.version<=0||window.browser.version>8)&&e.off("click.pjax").on("click.pjax","a[href]",function(){var t=$(this),e=t.attr("href"),a=t.attr("target"),r=t.attr("data-pjax");if(e&&"_blank"!==a&&void 0!==r&&"false"!==r)try{return n.makePjaxAction(e),!1}catch(i){}});try{n.Module.jkbd.DOM=t}catch(a){}},k=function(){if(!k.hasInit){k.hasInit=!0;var e=t.cookie("userInfo");if(!e||"undefined"===e){var a={cityCode:__nodeConfig.cityCode,daihao:"c1",course:"kemu1",vary:"0"};t.cookie("userInfo",a)}$(window).on("popstate",v),i.off("history").on("history",v),n.makePjaxAction=function(t){window.history.pushState?(window.history.pushState(null,null,t),i.trigger("history",t)):window.location=t},g(),v()}};return{init:k,ipLocation:u}});